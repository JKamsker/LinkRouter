<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="clr-namespace:LinkRouter.Settings.ViewModels;assembly=LinkRouter.Settings.Core"
             x:Class="LinkRouter.Settings.Avalonia.Views.RulesWorkspacePage">
    <ScrollViewer HorizontalScrollBarVisibility="Disabled">
        <StackPanel Margin="{StaticResource SettingsPageMargin}"
                    Spacing="{StaticResource SettingsPageSpacing}">
            <TextBlock Text="Rules" Classes="PageTitle" />

            <Grid ColumnDefinitions="2*,3*" ColumnSpacing="20">
                <StackPanel Spacing="{StaticResource SettingsCardSpacing}">
                    <Border Classes="SettingsCard">
                        <StackPanel Classes="SettingsCardContent">
                            <TextBlock Text="Rule list" Classes="SectionTitle" />

                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <Button Content="Add" Command="{Binding AddRuleCommand}" />
                                <Button Content="Duplicate"
                                        Command="{Binding DuplicateRuleCommand}"
                                        CommandParameter="{Binding SelectedRule}" />
                                <Button Content="Delete"
                                        Command="{Binding DeleteRuleCommand}"
                                        CommandParameter="{Binding SelectedRule}" />
                                <Button Content="Move Up"
                                        Command="{Binding MoveUpCommand}"
                                        CommandParameter="{Binding SelectedRule}" />
                                <Button Content="Move Down"
                                        Command="{Binding MoveDownCommand}"
                                        CommandParameter="{Binding SelectedRule}" />
                            </StackPanel>

                            <ListBox ItemsSource="{Binding Rules}"
                                     SelectedItem="{Binding SelectedRule, Mode=TwoWay}">
                                <ListBox.ItemTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding DisplayName}" />
                                    </DataTemplate>
                                </ListBox.ItemTemplate>
                            </ListBox>
                        </StackPanel>
                    </Border>
                </StackPanel>

                <StackPanel Grid.Column="1" Spacing="{StaticResource SettingsCardSpacing}">
                    <Border Classes="SettingsCard">
                        <StackPanel Classes="SettingsCardContent">
                            <TextBlock Text="Selected rule" Classes="SectionTitle" />
                            <TextBlock Text="{Binding SelectedRule.DisplayName, FallbackValue=Select a rule to view details., TargetNullValue=Select a rule to view details.}"
                                       TextWrapping="Wrap" />

                            <ToggleSwitch Content="Enabled"
                                          IsChecked="{Binding SelectedRule.Enabled, Mode=TwoWay}"
                                          IsEnabled="{Binding HasSelectedRule}" />

                            <StackPanel Classes="SectionContent">
                                <TextBlock Text="Match" Classes="SectionTitle" />
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <ComboBox ItemsSource="{Binding MatchTypes}"
                                              SelectedItem="{Binding SelectedRule.Match, Mode=TwoWay}"
                                              Width="160"
                                              IsEnabled="{Binding HasSelectedRule}" />
                                    <TextBox Text="{Binding SelectedRule.Pattern, Mode=TwoWay}"
                                             Width="240"
                                             Watermark="Pattern"
                                             IsEnabled="{Binding HasSelectedRule}" />
                                </StackPanel>
                            </StackPanel>

                            <StackPanel Classes="SectionContent">
                                <TextBlock Text="Use profile" Classes="SectionTitle" />
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <ComboBox ItemsSource="{Binding ProfileOptions}"
                                              SelectedItem="{Binding SelectedRule.UseProfile, Mode=TwoWay}"
                                              Width="220"
                                              PlaceholderText="Select a configured profile"
                                              IsEnabled="{Binding HasSelectedRule}" />
                                    <Button Content="Clear"
                                            Command="{Binding ClearUseProfileCommand}"
                                            IsEnabled="{Binding HasSelectedRule}" />
                                </StackPanel>
                            </StackPanel>

                            <Button Content="Open editor"
                                    HorizontalAlignment="Left"
                                    Command="{Binding EditRuleCommand}"
                                    IsEnabled="{Binding HasSelectedRule}" />
                        </StackPanel>
                    </Border>

                    <Border Classes="SettingsCard">
                        <StackPanel Classes="SettingsCardContent">
                            <TextBlock Text="Test URL" Classes="SectionTitle" />
                            <TextBox Text="{Binding TestUrl, Mode=TwoWay}" />
                            <Button Content="Test rule" Command="{Binding TestRuleCommand}" />
                            <TextBlock Text="{Binding TestResult}" TextWrapping="Wrap" />
                            <TextBlock Text="{Binding TestError}" TextWrapping="Wrap" Foreground="Red" />
                        </StackPanel>
                    </Border>
                </StackPanel>
            </Grid>
        </StackPanel>
    </ScrollViewer>
</UserControl>
