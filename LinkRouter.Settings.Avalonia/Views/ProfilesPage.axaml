<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:fa="using:FluentAvalonia.UI.Controls"
             xmlns:conv="clr-namespace:LinkRouter.Settings.Avalonia.Converters"
             x:Class="LinkRouter.Settings.Avalonia.Views.ProfilesPage">
    <UserControl.Resources>
        <conv:StringHasValueConverter x:Key="StringHasValueConverter" />
        <conv:BooleanNotConverter x:Key="BooleanNotConverter" />
        <SolidColorBrush x:Key="SecondaryTextBrush" Color="#666666" />
    </UserControl.Resources>

    <Grid Margin="{StaticResource PageMargin}"
          RowDefinitions="Auto,*"
          ColumnDefinitions="340,*"
          RowSpacing="16"
          ColumnSpacing="24">
        <TextBlock Text="Browsers &amp; Profiles"
                   Grid.ColumnSpan="2"
                   Style="{StaticResource SectionHeaderTextStyle}" />

        <Border Grid.Row="1"
                Style="{StaticResource SettingsCardStyle}">
            <Grid RowDefinitions="Auto,*"
                  RowSpacing="16">
                <StackPanel Orientation="Horizontal"
                            Spacing="12">
                    <Button Content="Add Profile"
                            Command="{Binding AddProfileCommand}" />
                    <Button Content="Remove"
                            Command="{Binding RemoveProfileCommand}"
                            CommandParameter="{Binding SelectedProfile}" />
                </StackPanel>

                <ListBox Grid.Row="1"
                         ItemsSource="{Binding Profiles}"
                         SelectedItem="{Binding SelectedProfile, Mode=TwoWay}">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <TextBlock Text="{Binding Name}" />
                                <TextBlock Text="(Default)"
                                           Foreground="{StaticResource SecondaryTextBrush}"
                                           IsVisible="{Binding IsDefault}" />
                            </StackPanel>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>
            </Grid>
        </Border>

        <Border Grid.Row="1"
                Grid.Column="1"
                Style="{StaticResource SettingsCardStyle}">
            <ScrollViewer>
                <StackPanel Spacing="16">
                    <StackPanel Spacing="8">
                        <TextBlock Text="Profile Name" />
                        <TextBox Text="{Binding SelectedProfile.Name, Mode=TwoWay}" />
                    </StackPanel>

                    <CheckBox Content="Default"
                              IsChecked="{Binding SelectedProfileIsDefault, Mode=TwoWay}"
                              IsEnabled="{Binding SelectedProfile.Name, Converter={StaticResource StringHasValueConverter}}" />

                    <StackPanel Spacing="12"
                                IsVisible="{Binding SelectedProfile.IsAdvanced, Converter={StaticResource BooleanNotConverter}, FallbackValue=False, TargetNullValue=False}">
                        <TextBlock Text="Quick setup"
                                   Style="{StaticResource SectionSubheaderTextStyle}" />
                        <ComboBox ItemsSource="{Binding Browsers}"
                                  SelectedItem="{Binding SelectedBrowser, Mode=TwoWay}">
                            <ComboBox.ItemTemplate>
                                <DataTemplate>
                                    <StackPanel>
                                        <TextBlock Text="{Binding Name}" />
                                        <TextBlock Text="{Binding Path}"
                                                   FontSize="12"
                                                   Foreground="{StaticResource SecondaryTextBrush}" />
                                    </StackPanel>
                                </DataTemplate>
                            </ComboBox.ItemTemplate>
                        </ComboBox>

                        <ComboBox ItemsSource="{Binding DetectedProfiles}"
                                  SelectedItem="{Binding SelectedDetectedProfile, Mode=TwoWay}">
                            <ComboBox.ItemTemplate>
                                <DataTemplate>
                                    <StackPanel>
                                        <TextBlock Text="{Binding DisplayName}" />
                                        <TextBlock Text="{Binding UserDataDir}"
                                                   FontSize="12"
                                                   Foreground="{StaticResource SecondaryTextBrush}"
                                                   IsVisible="{Binding UserDataDir, Converter={StaticResource StringHasValueConverter}}" />
                                    </StackPanel>
                                </DataTemplate>
                            </ComboBox.ItemTemplate>
                        </ComboBox>

                        <CheckBox Content="Launch in new window"
                                  IsChecked="{Binding SelectedProfileNewWindow, Mode=TwoWay}" />
                    </StackPanel>

                    <Button Content="Advanced mode"
                            Command="{Binding EnterAdvancedModeCommand}"
                            IsEnabled="{Binding CanEnterAdvanced}" />

                    <StackPanel Spacing="12"
                                IsVisible="{Binding SelectedProfile.IsAdvanced, FallbackValue=False, TargetNullValue=False}">
                        <TextBlock Text="Advanced configuration"
                                   Style="{StaticResource SectionSubheaderTextStyle}" />

                        <StackPanel Spacing="6">
                            <TextBlock Text="Browser" />
                            <TextBox Text="{Binding SelectedProfile.Browser, Mode=TwoWay}" />
                        </StackPanel>

                        <StackPanel Spacing="6">
                            <TextBlock Text="Args Template" />
                            <TextBox Text="{Binding SelectedProfile.ArgsTemplate, Mode=TwoWay}" />
                        </StackPanel>

                        <StackPanel Spacing="6">
                            <TextBlock Text="Profile" />
                            <TextBox Text="{Binding SelectedProfile.Profile, Mode=TwoWay}" />
                        </StackPanel>

                        <StackPanel Spacing="6">
                            <TextBlock Text="User Data Dir" />
                            <TextBox Text="{Binding SelectedProfile.UserDataDir, Mode=TwoWay}" />
                        </StackPanel>

                        <StackPanel Spacing="6">
                            <TextBlock Text="Working Directory" />
                            <TextBox Text="{Binding SelectedProfile.WorkingDirectory, Mode=TwoWay}" />
                        </StackPanel>
                    </StackPanel>

                    <Button Content="Test Launch"
                            Command="{Binding TestLaunchCommand}"
                            CommandParameter="{Binding SelectedProfile}" />

                    <fa:InfoBar IsVisible="{Binding HasDetectionError}"
                                Severity="Error"
                                Message="{Binding DetectionError}" />
                </StackPanel>
            </ScrollViewer>
        </Border>
    </Grid>
</UserControl>
